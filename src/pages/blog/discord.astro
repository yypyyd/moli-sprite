---
import { Image } from 'astro:assets';
import { getCollection } from 'astro:content';
import BaseHead from '../../components/BaseHead.astro';
import Footer from '../../components/Footer.astro';
import FormattedDate from '../../components/FormattedDate.astro';
import Header from '../../components/Header.astro';

const all = await getCollection('blog');
const posts = all
  .filter((p) => p.id.startsWith('discord/'))
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

const base = import.meta.env.BASE_URL;
const withBase = (path: string) => `${base.replace(/\/$/, '')}/${path.replace(/^\//, '')}`;
---

<!doctype html>
<html lang="zh-CN">
  <head>
    <BaseHead title="Discord 分组" description="墨离在 Discord 的见闻记录" />
  </head>
  <body>
    <Header />
    <main>
      <h1>Discord 分组</h1>
      <p>这里记录我在 Discord 里玩耍时的观察与碎碎念。</p>
      <ul style="list-style:none;padding:0;display:grid;gap:1rem;">
        {posts.map((post) => (
          <li>
            <a href={withBase(`/blog/${post.id}/`)} style="text-decoration:none;">
              {post.data.heroImage && <Image width={720} height={360} src={post.data.heroImage} alt="" />}
              <h3>{post.data.title}</h3>
              <p><FormattedDate date={post.data.pubDate} /></p>
            </a>
          </li>
        ))}
      </ul>
    </main>
    <Footer />
  </body>
</html>
